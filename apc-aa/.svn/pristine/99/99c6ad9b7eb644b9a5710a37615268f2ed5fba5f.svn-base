<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Alerts</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.60.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="d0e1"></a>Alerts</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Jakub</span> <span class="surname">Ad&aacute;mek</span></h3><div class="affiliation"><span class="orgname">Econnect<br></span></div></div></div><div><p class="releaseinfo">$Id$</p></div><div><div class="revhistory"><table border="1" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="2"><b>Revision History</b></th></tr><tr><td align="left">Revision 1.1</td><td align="left">18.4.2003</td></tr><tr><td align="left" colspan="2">Updated the Step by step tutorial. Added a tip about links.</td></tr><tr><td align="left">Revision 1.0</td><td align="left">5.4.2003</td></tr><tr><td align="left" colspan="2">Extracted from the <a href="reader.html" target="_top">Reader Management</a> document and enhanced.</td></tr></table></div></div></div><div></div><hr></div><div class="toc"><dl><dt>1. <a href="#d0e45">Introduction</a></dt><dt>2. <a href="#d0e55">Email content</a></dt><dd><dl><dt>2.1. <a href="#d0e65">View Type Alerts Selection Set</a></dt></dl></dd><dt>3. <a href="#d0e101">Alerts module</a></dt><dt>4. <a href="#d0e217">Sending emails</a></dt><dt>5. <a href="#d0e241">Step by step tutorial</a></dt><dt>6. <a href="#d0e434">Tips</a></dt></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><span class="emphasis"><em>This file was created from the DocBook XML source. Please do modifications in the source, not here.</em></span></p></div><div class="abstract"><p class="title"><b>Abstract</b></p><p>This document describes the Alerts module. It is necessary you understand how readers are managed by the <a href="reader.html" target="_top">Reader Management slices</a> first.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e45"></a>1.&nbsp;Introduction</h2></div></div><div></div></div><p>AA Alerts are designed to deliver new AA items to users by e-mail. Slice Administrators choose the design and which kind of items from which slices to include. Readers subscribe for receiving the news and select how often: immediately when the news becomes Active (in the meaning of the bins in Item Manager) or a daily, weekly or monthly digest.</p><p>Anonymous forms (see <a href="anonym.html" target="_top">doc</a>) allow users to change their subscriptions. Users are identified by e-mail and they must confirm their e-mail address by a confirmation code received by e-mail to make sure the address is working.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e55"></a>2.&nbsp;Email content</h2></div></div><div></div></div><p>This section describes how are chosen the new items which appear in the email.</p><p>One Alerts module is one email from the reader's point of view. A set of Selections is assigned to the module. The Selections are defined in views of type &#8220;<span class="quote">Alerts Selection Set</span>&#8221;.</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e65"></a>2.1.&nbsp;View Type &#8220;<span class="quote">Alerts Selection Set</span>&#8221;</h3></div></div><div></div></div><p>You define this view in the slices, from which you want to send new items. The first check box, &#8220;<span class="quote">Group by selections</span>&#8221;, will be explained later. The view defines the Selections, which have a description and a set of the powerful <a href="???" target="_top"><tt class="constant">conds[]</tt> and <tt class="constant">sort[]</tt></a> parameters, the same as are used with <tt class="constant">slice.php3</tt> in search forms. You can e.g. create one selection for each category. When you open an Alerts view, there are always two empty pairs of boxes for two new Selections. If you want to define more Selections, store the view settings and reopen it.</p><p>You can add Selections from several views and several slices to one Alerts module. Readers may choose which selections they want to receive. Some items may pass the <tt class="constant">conds[]</tt> conditions of several Selections. If you check &#8220;<span class="quote">Group by selections</span>&#8221;, the view is generated for each Selection and some items may appear several times in the email. If you leave &#8220;<span class="quote">Group by selections</span>&#8221; unchecked, first all items which pass the reader's Selections are collected and the view is generated only once for all of them.</p><p>The setting &#8220;<span class="quote">Fulltext URL</span>&#8221; links to the page where is an item viewed when the reader clicks on its headline in the email. Of course if you do not add a linked headline to the view design, this setting is not used.</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e101"></a>3.&nbsp;Alerts module</h2></div></div><div></div></div><p>The Alerts module appears like other regular modules in the slice select box. It offers these pages:</p><div class="table"><a name="d0e106"></a><p class="title"><b>Table&nbsp;1.&nbsp;Alerts menu</b></p><table summary="Alerts menu" border="1"><colgroup><col><col></colgroup><tbody><tr><td>Settings</td><td>Core settings for the Alerts module, see below.</td></tr><tr><td>Selections</td><td>Choose which selections you want to show and their order. Selections are defined in views of type Alerts Selection Set in the slices from which you want to send new items. Each selection has a description and a set of the Mind that if some item appears in several selections, it will be repeated in the mail. Try to make selections mutually exclusive.</td></tr><tr><td>Send emails</td><td>You can manually send the digest to all readers. And you can send an example email to yourself to see exactly what readers receive.</td></tr><tr><td>Reader Management</td><td>Sets the Reader Management Slice which feeds this Alerts. Allows to add, delete and refresh the Alerts-specific fields to the slice. When you change the list on the Selections page, use Sync to refresh the appropriate constant group in the Reader Management Slice.</td></tr><tr><td>Email Templates</td><td>Allows to edit all email templates.</td></tr></tbody></table></div><p>The fields added by Sync with reader slice are:</p><div class="table"><a name="d0e138"></a><p class="title"><b>Table&nbsp;2.&nbsp;Alerts specific fields</b></p><table summary="Alerts specific fields" border="1"><colgroup><col><col></colgroup><tbody><tr><td>how often</td><td>How often the reader receives a digest: instant (each new item in one e-mail), daily, weekly, monthly.</td></tr><tr><td>choose selections</td><td>Multiple checkboxes allowing to choose which selections from the collection the reader wants to read. New parameters of the Multiple Checkboxes field Input type allow to view them in a table, see the Parameter Wizard.</td></tr></tbody></table></div><p>You may show <span class="emphasis"><em>how often</em></span> or <span class="emphasis"><em>choose selections </em></span>in the anonymous forms or you may set defaults by hidden fields.</p><p>The core settings in Alerts Admin - Settings include these special fields:</p><div class="table"><a name="d0e163"></a><p class="title"><b>Table&nbsp;3.&nbsp;Alerts Settings</b></p><table summary="Alerts Settings" border="1"><colgroup><col><col></colgroup><tbody><tr><td>form URL</td><td>The URL to your pages with the &#8220;<span class="quote">Change personal details</span>&#8221; form. This URL is used to create the <tt class="constant">_#COLLFORM</tt> alias.</td></tr><tr><td>welcome email</td><td>A link to the email template for a message sent to new users on subscription. The edit icon on the right allows you to jump to the email edit form.</td></tr><tr><td>alert email</td><td>A link to the email template of the alert sent instant / daily / ... and containing new items.</td></tr></tbody></table></div><p>The email templates (welcome and alert) are stored in the common table <tt class="constant">email</tt> and are defined using aliases and alias functions. This allows a completely free design. The formatted new items are added by the <tt class="constant">_#FILTERS_</tt> alias. If you want to send different texts to readers with different &#8220;<span class="quote">how often</span>&#8221;, use the <tt class="constant">switch</tt> function on the alias <tt class="constant">_#HOWOFTEN</tt>. To allow readers to confirm their email and change their personal settings, use the alias <tt class="constant">_#COLLFORM</tt>, which is the URL you filled in Alerts Admin - Settings, with an additional 9 letters parameter containing the <a href="#">access code</a>.</p><p>An example of both email types is added by <tt class="constant">sql_update</tt>.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e217"></a>4.&nbsp;Sending emails</h2></div></div><div></div></div><p>There are two ways of sending the emails: regularly by cron or manually.</p><p>The cron items are added to the <tt class="constant">cron</tt> table automatically by <tt class="constant">sql_update.php3</tt>. You must set up cron on your server, <a href="http://apc-aa.sourceforge.net/faq#cron" target="_top">see FAQ</a>. There are four items for the four different frequencies (instant, daily, weekly, monthly). The info when were which Alerts module emails generated is stored in the table <tt class="constant">alerts_collection_howoften</tt>. The emails are created so that readers see the HTML version in e-mail clients supporting HTML and the text version in clients supporting text only. The text form is created by deleting all HTML tags. Technically speaking, it is a MIME multi-part/alternative message with a text part and a HTML part.</p><p>If you want to send emails manually, use the &#8220;<span class="quote">Send emails</span>&#8221; page in the Alerts module.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e241"></a>5.&nbsp;Step by step tutorial</h2></div></div><div></div></div><p>Here is a tutorial, describing in steps how you can try the Alerts module. </p><p>WARNING: The result does not use Authorization, the personal info is protected by a password. You should use other settings on several places when using Authorization. </p><div class="orderedlist"><ol type="1"><li>Update to the new AA version from Subversion (svn) and run <tt class="constant">sql_update.php3</tt></li><li><p>Create &#8220;<span class="quote">My Readers</span>&#8221;:</p><div class="orderedlist"><ol type="a"><li>Create a new slice from the &#8220;<span class="quote">Reader Management Minimal</span>&#8221; template with the name &#8220;<span class="quote">My Readers</span>&#8221;</li><li>Set &#8220;<span class="quote">Allow anonymous posting</span>&#8221; to &#8220;<span class="quote">Active</span>&#8221; </li><li>Set &#8220;<span class="quote">Allow anonymous editing</span>&#8221; to &#8220;<span class="quote">Authorized by a password field</span>&#8221; <span class="emphasis"><em>(with Authorization, use &#8220;<span class="quote">Readers, authorized by HTTP auth</span>&#8221;)</em></span></li></ol></div></li><li><p>Create selections:</p><div class="orderedlist"><ol type="a"><li>In your favorite test slice, create a view with type &#8220;<span class="quote">Alerts Digest</span>&#8221;. Fill something intelligent into the design, particularly the &#8220;<span class="quote">Odd Rows</span>&#8221; field. Fill also the &#8220;<span class="quote">Fulltext URL</span>&#8221; field.</li><li>Fill the Selection 1 and 2 Description with &#8220;<span class="quote">My Selection 1</span>&#8221; and 2. Do not fill <tt class="constant">conds[]</tt>, you can play with them when you are an Alerts-master</li></ol></div></li><li><p>Create and set Alerts:</p><div class="orderedlist"><ol type="a"><li>Create a new Alerts module</li><li>Fill the name &#8220;<span class="quote">My Alerts</span>&#8221;. Fill the form URL with some web folder to which you have access, e.g. <tt class="constant">http://have_access_to/myalerts.shtml</tt></li><li>Click on Selections and insert My Selection 1 and 2 into the Alerts</li><li>Click on Reader management, change to My Readers</li><li>Click on Add or refresh fields. A message &#8220;<span class="quote">2 field(s) added</span>&#8221; appears.</li></ol></div></li><li><p>Copy show_results.php3</p><div class="orderedlist"><ol type="a"><li>Copy the script from <tt class="constant">doc/script/show_result.php3</tt> to the same location where you created myalerts.shtml. </li></ol></div></li><li><p>Create the anonymous form:</p><div class="orderedlist"><ol type="a"><li>Move to My Readers</li><li>In Slice Admin - Fields uncheck Show for Username and check Required for Email. Perhaps also uncheck Required for Password. <span class="emphasis"><em>(With Authorization, do nothing, the defaults are OK)</em></span></li><li>Choose Slice Admin - Anonymous Form Wizard</li><li>Fill the OK and Error URL with the same URL described above, similar to <tt class="constant">http://have_access_to/myalerts.shtml</tt></li><li><p>Fill the URL of yours show_result.php3 and check the box &#8220;<span class="quote">Use a PHP script ...</span>&#8221;</p></li><li>Uncheck all fields except of Email, Password, How often and Selections</li><li>Click on Show form and copy the form HTML to the file <tt class="constant">http://have_access_to/myalerts.shtml</tt></li></ol></div></li><li><p>Subscribe to Alerts:</p><div class="orderedlist"><ol type="a"><li><p>Go to the address <tt class="constant">http://have_access_to/myalerts.shtml</tt> and fill in your email address, the password &#8220;<span class="quote">abcde</span>&#8221;, how often &#8220;<span class="quote">daily</span>&#8221; and choose one of the filters</p></li><li><p>Click on Send, a message appears.</p></li><li><p>Check email and confirm your subscription: Click on the link received in the Welcome email</p></li></ol></div></li><li><p>Send alerts:</p><div class="orderedlist"><ol type="a"><li>Go to My Alerts, Send emails. Choose &#8220;<span class="quote">daily</span>&#8221; and click on &#8220;<span class="quote">Go!</span>&#8221; at &#8220;<span class="quote">Send example</span>&#8221;. You should receive a digest of all items added in the last 24 hours to your favorite test slice. If there are no such items, add some: go to Selections, click on My Selection 1, this moves you to your favorite test slice.</li><li>Try the same with &#8220;<span class="quote">Send now alerts to all users</span>&#8221;. Note this will store the time into the database and if you click again on this button, no mail will be sent because no message was added between the two runs.</li></ol></div></li><li>Add items to your favorite test slice and test that you receive them</li></ol></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e434"></a>6.&nbsp;Tips</h2></div></div><div></div></div><p><span class="emphasis"><em>Alerts-only reader management: </em></span>You do not need the username, but the email is required. Change these Fields settings. Perhaps you even do not need to password-protect the reader personal info. Change also the &#8220;<span class="quote">Allow anonymous posting / editing</span>&#8221; slice settings.</p><p><span class="emphasis"><em>Filtering readers who are not yet confirmed: </em></span>Change the design of the Item Manager in Slice Admin to show the alias <tt class="constant">_#MAILCONF</tt>. This alias shows &#8220;<span class="quote">yes</span>&#8221; or &#8220;<span class="quote">no</span>&#8221;. But it is created by the <tt class="constant">f_c</tt> function and the values in the database are 0 or 1. Thus give &#8220;<span class="quote">0</span>&#8221; and not &#8220;<span class="quote">no</span>&#8221; into the Search box.</p><p><span class="emphasis"><em>Filtering readers receiving a selection:</em></span> Add the Alerts Selections to Item Manager. Create an alias using the function <tt class="constant">f_h</tt> with the parameter <tt class="constant">,</tt> (comma). You will see the selection IDs prefixed by <tt class="constant">f</tt>. Now you understand why you should enter something like &#8220;<span class="quote">f45</span>&#8221; into the Search box.</p><p><span class="emphasis"><em>Links between Alerts and the related slices. </em></span>Several links help to jump quickly between the modules. In Alerts, on page Reader management, you can click on the slice name. On page Selections, there are links to all selections and to all slices containing these selections. There are backward links also: On the Item Manager page.</p></div></div></body></html>